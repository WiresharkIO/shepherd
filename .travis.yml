language: c

services:
  - docker

addons:
  apt:
    packages:
     - sshpass

script:
 - export PROJECT_DIR=$PWD
 - cd software/packaging
 - docker build -t shepherd-builder-img .
 - docker create -it --name shepherd-builder shepherd-builder-img
 - docker cp $PROJECT_DIR/software shepherd-builder:/code
 - docker start -a shepherd-builder
 - docker cp shepherd-builder:/artifacts $PROJECT_DIR/
 - cd $PROJECT_DIR

after_success:
  - export SSHPASS=$DEPLOY_PASS
  - ls artifacts/debian
  - cat $DEPLOY_USER@$DEPLOY_HOST
  - sshpass -e scp artifacts/debian/* $DEPLOY_USER@$DEPLOY_HOST:shepherd/debian/
